<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" href="./auth-styles.css" />
    <title>LinkSnip - URL Shortener</title>
    <meta
      name="description"
      content="Create short URLs with LinkSnip - Fast, reliable URL shortening service"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/material-design-iconic-font@2.2.0/dist/css/material-design-iconic-font.min.css"
    />
  </head>
  <body>
    <%- include('./partials/header') %> 
    <% if(isLoggedIn) { %>
    <h2>You are logged in!</h2>
    <%} else { %>
    <h2>You are not logged in..</h2>
    <%}%>
    <div class="container">
      <h1>üîó LinkSnip.</h1>

      <form action="/" method="post">
        <div>
          <label for="url">üìù Enter URL</label>
          <input
            type="url"
            name="url"
            id="url"
            required
            placeholder="https://example.com"
          />
        </div>
        <div>
          <label for="shortCode">‚ö° Short Code (optional)</label>
          <input
            type="text"
            name="shortCode"
            id="shortCode"
            placeholder="Leave empty for random code"
          />
        </div>
        <% if (typeof errors !== 'undefined' && errors && errors.length > 0) { %>
          <% errors.forEach((error) => { %>
            <p class="flash-error"><%= typeof error === 'string' ? error : JSON.stringify(error) %></p>
          <% }); %>
        <% } %>
        <button type="submit">‚ú® Shorten URL</button>
      </form>

      <h2>üìã Your Shortened URLs</h2>
      <ul class="url-list">
        <% if (links && links.length > 0) { %> 
        <% links.forEach(function(link, index) { %>
        <li class="url-item">
          <div class="url-info">
            <div class="url-main">
              <span class="url-number">#<%= index + 1 %></span>
              <a href="/<%= link.shortCode %>" target="_blank" class="short-link">
                üîó localhost:3000/<%= link.shortCode %>
              </a>
            </div>
            <div class="url-original">
              <small><%= link.url %></small>
            </div>
          </div>
          <div class="url-actions">
            <button class="action-btn copy-btn" data-url="http://<%= link.host %>/<%= link.shortCode %>" title="Copy link">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
            </button>
            
            <a href="/edit/<%= link.id %>" class="action-btn edit-btn" title="Edit link">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.12 2.12 0 0 1 3 3l-9.5 9.5L8 16l1.5-4.5 9.5-9.5z"></path>
              </svg>
            </a>
            
            <form action="/delete/<%=link.id%>" method="post" style="display: inline;" class="delete-form">
              <button type="submit" class="action-btn delete-btn" data-id="<%= link.id %>" title="Delete link">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3,6 5,6 21,6"></polyline>
                  <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6M8,6V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
                </svg>
              </button>
            </form>
          </div>
        </li>
        <% }); %> 
        <% } else { %>
        <li style="color: #666; font-style: italic; text-align: center">
          üéØ No shortened URLs yet. Create your first one above! üëÜ
        </li>
        <% } %>
      </ul>
    </div>

    <%- include('./partials/footer') %>

    <script>
      // Add smooth animations and interactions
      document.addEventListener("DOMContentLoaded", function () {
        // Add animation to form elements
        const inputs = document.querySelectorAll("input");
        inputs.forEach((input) => {
          input.addEventListener("focus", function () {
            this.style.transform = "scale(1.02)";
          });

          input.addEventListener("blur", function () {
            this.style.transform = "scale(1)";
          });
        });

        // Add click animation to button
        const button = document.querySelector("button");
        if (button) {
          button.addEventListener("click", function (e) {
            // Create ripple effect
            const ripple = document.createElement("span");
            const rect = this.getBoundingClientRect();
            const size = Math.max(rect.width, rect.height);
            const x = e.clientX - rect.left - size / 2;
            const y = e.clientY - rect.top - size / 2;

            ripple.style.cssText = `
                        position: absolute;
                        width: ${size}px;
                        height: ${size}px;
                        left: ${x}px;
                        top: ${y}px;
                        background: rgba(255, 255, 255, 0.5);
                        border-radius: 50%;
                        transform: scale(0);
                        animation: ripple 0.6s ease-out;
                        pointer-events: none;
                    `;

            this.style.position = "relative";
            this.style.overflow = "hidden";
            this.appendChild(ripple);

            setTimeout(() => ripple.remove(), 600);
          });
        }

        // Add copy to clipboard functionality
        const copyButtons = document.querySelectorAll(".copy-btn");
        copyButtons.forEach((button) => {
          button.addEventListener("click", function (e) {
            e.preventDefault();
            const url = this.getAttribute('data-url');
            
            navigator.clipboard.writeText(url).then(() => {
              // Show copy success feedback
              const originalContent = this.innerHTML;
              this.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              `;
              this.style.color = "#28a745";
              this.style.background = "rgba(40, 167, 69, 0.1)";

              setTimeout(() => {
                this.innerHTML = originalContent;
                this.style.color = "";
                this.style.background = "";
              }, 2000);
            }).catch(() => {
              // Fallback for older browsers
              const textArea = document.createElement("textarea");
              textArea.value = url;
              document.body.appendChild(textArea);
              textArea.select();
              document.execCommand('copy');
              document.body.removeChild(textArea);
              
              // Show success feedback
              const originalContent = this.innerHTML;
              this.innerHTML = `
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="20,6 9,17 4,12"></polyline>
                </svg>
              `;
              this.style.color = "#28a745";
              
              setTimeout(() => {
                this.innerHTML = originalContent;
                this.style.color = "";
              }, 2000);
            });
          });
        });

        // Add entrance animations to list items
        const listItems = document.querySelectorAll(".url-item");
        listItems.forEach((item, index) => {
          item.style.opacity = "0";
          item.style.transform = "translateY(20px)";

          setTimeout(() => {
            item.style.transition = "all 0.5s ease";
            item.style.opacity = "1";
            item.style.transform = "translateY(0)";
          }, index * 100);
        });
      });

      // Add CSS animation for ripple effect
      const style = document.createElement("style");
      style.textContent = `
            @keyframes ripple {
                to {
                    transform: scale(2);
                    opacity: 0;
                }
            }
            
            .container {
                animation: fadeIn 0.8s ease-out;
            }
            
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* Modern URL list styling */
            .url-list {
                list-style: none;
                padding: 0;
                margin: 20px 0;
            }

            .url-item {
                display: flex;
                align-items: center;
                justify-content: space-between;
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 8px;
                padding: 15px;
                margin: 10px 0;
                transition: all 0.2s ease;
            }

            .url-item:hover {
                border-color: #667eea;
                box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
            }

            .url-info {
                flex: 1;
                display: flex;
                flex-direction: column;
                gap: 5px;
            }

            .url-main {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .url-number {
                font-weight: bold;
                color: #667eea;
                min-width: 30px;
            }

            .short-link {
                color: #667eea;
                text-decoration: none;
                font-weight: 500;
                font-size: 16px;
            }

            .short-link:hover {
                text-decoration: underline;
            }

            .url-original {
                margin-left: 40px;
                color: #6c757d;
            }

            .url-original small {
                font-size: 13px;
                max-width: 400px;
                display: inline-block;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .url-actions {
                display: flex;
                gap: 8px;
                align-items: center;
            }

            .action-btn {
                background: none;
                border: none;
                padding: 8px;
                border-radius: 6px;
                cursor: pointer;
                color: #6c757d;
                transition: all 0.2s ease;
                text-decoration: none;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .action-btn:hover {
                background: #e9ecef;
                color: #495057;
                transform: translateY(-1px);
            }

            .copy-btn:hover {
                color: #28a745;
                background: rgba(40, 167, 69, 0.1);
            }

            .edit-btn:hover {
                color: #ffc107;
                background: rgba(255, 193, 7, 0.1);
            }

            .delete-btn:hover {
                color: #dc3545;
                background: rgba(220, 53, 69, 0.1);
            }

            .action-btn svg {
                transition: transform 0.2s ease;
            }

            .action-btn:hover svg {
                transform: scale(1.1);
            }
            
            /* Fix for form buttons used as action buttons */
            form .action-btn {
                background: none;
                border: none;
                padding: 8px;
                border-radius: 6px;
                cursor: pointer;
                color: #6c757d;
                transition: all 0.2s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: inherit;
            }
            
            /* Override the general hover transform for form buttons to prevent double scaling */
            form .action-btn:hover {
                transform: translateY(-1px);
            }
        `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
